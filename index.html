<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CATE System Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <aside class="sidebar">
        <div class="logo" onclick="switchTab('dashboard')" title="ุงูุฐูุงุจ ูููุญุฉ ุงูููุงุฏุฉ">
            <img src="Only CATE.png" alt="CATE System PRO">
        </div>
        <nav>
            <ul>
                <li onclick="switchTab('dashboard')" class="active" id="nav-dashboard"><i class="fa-solid fa-chart-line"></i> ููุญุฉ ุงูููุงุฏุฉ</li>
                <li onclick="switchTab('contracts')" id="nav-contracts"><i class="fa-solid fa-file-contract"></i> ุงูุนููุฏ ูุงูุตูุงูุฉ</li>
                <li onclick="switchTab('reports')" id="nav-reports"><i class="fa-solid fa-clipboard-check"></i> ุชูุงุฑูุฑ ุงูุนููุงุก</li>
            </ul>
        </nav>
        <div class="user-profile-box">
            <div style="width:35px; height:35px; background:var(--primary); color:white; border-radius:50%; display:grid; place-items:center; font-size:0.9rem;">๐ค</div>
            <div>
                <div style="font-size:0.9rem; font-weight:bold; color:var(--text-main);">ุฎุงูุฏ ูุฌุฏู</div>
                <div style="font-size:0.75rem; color:var(--text-light);">IT & Business Solutions Manager</div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header>
            <div class="search-wrapper" id="main-search-bar">
                <input type="text" placeholder="ุจุญุซ ุดุงูู (ุดุฑูุฉุ ุนููู)..." onkeyup="globalSearch(this.value)">
                <i class="fa-solid fa-search"></i>
            </div>
            <div class="header-actions">
                <div style="position: relative;">
                    <button class="icon-btn" id="notif-btn" onclick="toggleNotifications()">
                        <i class="fa-solid fa-bell"></i>
                        <span id="notif-badge" class="notif-badge" style="display:none;">0</span>
                    </button>
                    <div id="notif-dropdown" class="notif-dropdown">
                        <div class="notif-header">
                            <span>ุงูุชูุจููุงุช ุงูุนุงุฌูุฉ</span>
                            <span style="font-size:0.8rem; color:var(--text-light); font-weight:normal; cursor:pointer;" onclick="toggleNotifications()">ุฅุบูุงู</span>
                        </div>
                        <div class="notif-list" id="notif-list-body"></div>
                    </div>
                </div>
            </div>
        </header>

        <div class="content-scroll">
            
            <div id="tab-dashboard" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 style="margin:0;">ููุญุฉ ุงููุนูููุงุช</h2>
                        <span style="font-size:0.9rem; color:var(--text-light);" id="currentDate"></span>
                    </div>
                    <button class="btn btn-primary" onclick="openModal()"><i class="fa-solid fa-plus"></i> ุนูุฏ ุฌุฏูุฏ</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card" style="border-bottom-color: var(--success); cursor: pointer;" onclick="filterDashboard('active')">
                        <h3 id="stat-active" class="counter-anim" style="color:var(--success)">0</h3>
                        <p>ุนููุฏ ุณุงุฑูุฉ</p>
                        <i class="fa-solid fa-check-circle icon-bg" style="color:var(--success)"></i>
                    </div>
                
                    <div class="stat-card" style="border-bottom-color: var(--warning); cursor: pointer;" onclick="filterDashboard('soon')">
                        <h3 id="stat-soon" class="counter-anim" style="color:var(--warning)">0</h3>
                        <p>ุชูุจูู ุงูุชุฑุงุจ ููุนุฏ</p>
                        <i class="fa-solid fa-stopwatch icon-bg" style="color:var(--warning)"></i>
                    </div>
                
                    <div class="stat-card" style="border-bottom-color: var(--danger); cursor: pointer;" onclick="filterDashboard('due')">
                        <h3 id="stat-due" class="counter-anim" style="color:var(--danger)">0</h3>
                        <p>ุตูุงูุงุช/ุนููุฏ ูุณุชุญูุฉ</p>
                        <i class="fa-solid fa-triangle-exclamation icon-bg" style="color:var(--danger)"></i>
                    </div>
                
                    <div class="stat-card" style="border-bottom-color: var(--secondary); cursor: pointer;" onclick="filterDashboard('hold')">
                        <h3 id="stat-hold" class="counter-anim" style="color:var(--secondary)">0</h3>
                        <p>ุนููุฏ ูุนููุฉ (Hold)</p>
                        <i class="fa-solid fa-pause icon-bg" style="color:var(--secondary)"></i>
                    </div>
                </div>

                <div class="dashboard-row-large">
                    <div class="card-container card-padding">
                        <div class="card-title">
                            <span><i class="fa-solid fa-chart-column" style="color:var(--primary)"></i> ุชููุนุงุช ุถุบุท ุงูุตูุงูุฉ (6 ุดููุฑ)</span>
                        </div>
                        <div style="height: 250px;">
                            <canvas id="forecastChart"></canvas>
                        </div>
                    </div>
                    <div class="card-container card-padding" style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
                        <h4 style="margin:0 0 15px 0;">ุชูุฒูุน ุญุงูุฉ ุงูุฃุณุทูู</h4>
                        <div style="height: 200px; width: 200px;">
                            <canvas id="dashboardChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="dashboard-row-tri">
                    <div class="card-container card-padding">
                        <div class="card-title">
                            <span style="color:var(--danger)"><i class="fa-solid fa-bell"></i> ุชูุจููุงุช ุนุงุฌูุฉ</span>
                            <span class="badge badge-red" id="alert-count-badge" style="display:none">0</span>
                        </div>
                        <div style="overflow-y:auto; max-height:300px; padding-right:5px;" id="alerts-container"></div>
                        <div id="no-alerts-msg" style="text-align:center; padding:20px; color:var(--text-light); display:none;">
                            <i class="fa-regular fa-circle-check" style="font-size:2rem; margin-bottom:10px; color:var(--success)"></i>
                            <p style="margin:0">ูู ุงูุฃููุฑ ุชูุงูุ ูุง ุชูุฌุฏ ุชูุจููุงุช!</p>
                        </div>
                    </div>

                    <div class="card-container card-padding">
                        <div class="card-title">
                            <span style="color:var(--warning)"><i class="fa-solid fa-fire"></i> ุงูุฃูุซุฑ ุชุดุบููุงู</span>
                        </div>
                        <div id="top-machines-container"></div>
                        <div id="no-machines-msg" style="text-align:center; padding:20px; color:var(--text-light); display:none;">ูุง ุชูุฌุฏ ุจูุงูุงุช</div>
                    </div>

                    <div class="card-container card-padding">
                        <div class="card-title">
                            <span style="color:var(--info)"><i class="fa-solid fa-clock-rotate-left"></i> ุขุฎุฑ ุงูุชุญุฑูุงุช</span>
                        </div>
                        <ul class="activity-list" id="activity-feed"></ul>
                    </div>
                </div>
            </div>

            <div id="tab-contracts" class="tab-content hidden">
                <div class="section-header">
                    <div>
                        <h2 style="margin:0;">ุฅุฏุงุฑุฉ ุงูุนููุฏ</h2>
                        <p style="margin:5px 0 0; font-size:0.9rem; color:var(--text-light);">ูุงุฆูุฉ ุจุฌููุน ุงูุนููุฏ ุงููุณุฌูุฉ ูุฌุฏุงูู ุตูุงูุชูุง ุงููุชููุนุฉ</p>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-primary" onclick="openModal()"><i class="fa-solid fa-plus"></i> ุนูุฏ ุฌุฏูุฏ</button>
                    </div>
                </div>
                <div class="card-container">
                    <div class="table-responsive">
                        <table id="main-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">ุงูุดุฑูุฉ / ุงูุนููู</th>
                                    <th style="width: 20%;">ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุนูุฏ</th>
                                    <th style="width: 20%;">ุชุงุฑูุฎ ููุงูุฉ ุงูุนูุฏ</th>
                                    <th style="width: 15%;">ุงูุฅูุฌุงุฒ</th>
                                    <th style="width: 20%;">ุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="contracts-body"></tbody>
                        </table>
                    </div>
                    <div id="no-contracts-msg" style="text-align:center; padding:40px; color:var(--text-light);">ูุง ุชูุฌุฏ ุนููุฏ ูุณุฌูุฉ. ุงุจุฏุฃ ุจุฅุถุงูุฉ ุนูุฏ ุฌุฏูุฏ.</div>
                </div>
            </div>

            <div id="tab-company-assets" class="tab-content hidden">
                <div class="section-header">
                    <div>
                        <button class="btn" onclick="switchTab('contracts')" style="background:white; border:1px solid var(--border-color); margin-bottom:10px; color:var(--text-light);">
                            <i class="fa-solid fa-arrow-right"></i> ุฑุฌูุน ูููุงุฆูุฉ
                        </button>
                        <h2 style="margin:0;" id="asset-company-title">ุงุณู ุงูุดุฑูุฉ</h2>
                        <p style="margin:5px 0 0; font-size:0.9rem; color:var(--text-light);">ุฅุฏุงุฑุฉ ุงููุงูููุงุช ูุงููุนุฏุงุช (Compressors, Dryers & Vacuum Pumps)</p>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn" style="background:#0284c7; color:white; border:none;" onclick="openInventoryModal()"><i class="fa-solid fa-boxes-stacked"></i> ุฌุฑุฏ ูุทุน ุงูุบูุงุฑ</button>
                        <button class="btn btn-primary" onclick="openAddMachineModal()"><i class="fa-solid fa-plus"></i> ADD</button>
                    </div>
                </div>
                
                <div id="assets-grid-container" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:20px;">
                </div>
                <div id="no-assets-msg" style="text-align:center; padding:40px; color:var(--text-light); display:none;">
                    <i class="fa-solid fa-boxes-stacked" style="font-size:3rem; margin-bottom:15px; opacity:0.3;"></i>
                    <p>ูุง ุชูุฌุฏ ูุงูููุงุช ูุณุฌูุฉ ููุฐู ุงูุดุฑูุฉ. ุงุถุบุท ADD ููุฅุถุงูุฉ.</p>
                </div>
            </div>

            <div id="tab-reports" class="tab-content hidden">
                <div id="reports-list-view">
                    <div class="section-header">
                        <h2 style="margin:0;">ุชูุงุฑูุฑ ุงูุนููุงุก</h2>
                    </div>
                    <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:20px;" id="reports-grid"></div>
                    <div id="no-reports-msg" style="text-align:center; padding:40px; color:var(--text-light);">ูุง ุชูุฌุฏ ุนููุฏ ูุนุฑุถ ุงูุชูุงุฑูุฑ.</div>
                </div>

                <div id="reports-detail-view" class="hidden">
                    <button class="btn" onclick="backToReports()" style="margin-bottom:20px; background:var(--bg-card); border:1px solid var(--border-color);">
                        <i class="fa-solid fa-arrow-right"></i> ุฑุฌูุน ูููุงุฆูุฉ
                    </button>
                    
                    <div class="crm-header">
                        <div>
                            <h2 style="margin:0;" id="detail-company">ุงุณู ุงูุดุฑูุฉ</h2>
                            <p style="margin:5px 0 0; opacity:0.8;" id="detail-client">ุงุณู ุงูุนููู</p>
                        </div>
                        <div class="crm-stats">
                            <div class="crm-stat-item"><h2 id="count-total">0</h2><span>ุฅุฌูุงูู</span></div>
                            <div class="crm-stat-item"><h2 id="count-done">0</h2><span>ุชูุช</span></div>
                            <div class="crm-stat-item" style="color: #cbd5e1;"><h2 id="count-left">0</h2><span>ูุชุจูู</span></div>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: var(--text-main); font-size:1rem;"><i class="fa-solid fa-1"></i> ุงุฎุชุฑ ุงููุงูููุฉ ูุนุฑุถ ุณุฌููุง:</h3>
                        
                        <div id="report-assets-selection" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:15px;">
                        </div>

                        <div id="no-assets-report-msg" style="display:none; padding:20px; background:#fff; border:1px dashed #ccc; border-radius:8px; text-align:center; color:var(--text-light);">
                            <i class="fa-solid fa-circle-exclamation" style="margin-bottom:10px; display:block; font-size:1.5rem;"></i>
                            ูุง ุชูุฌุฏ ูุงูููุงุช ูุณุฌูุฉ ูู ูุฐุง ุงูุนูุฏ.<br>ูุฑุฌู ุฅุถุงูุชูุง ุฃููุงู ูู ูุณู "ุงูุนููุฏ ูุงูุตูุงูุฉ".
                        </div>
                    </div>

                    <div id="report-action-section" class="hidden" style="animation: fadeInUp 0.4s ease-out;">
                        <div style="margin-bottom:15px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">
                            <h3 style="margin:0; color: var(--primary); font-size:1.1rem;">
                                <i class="fa-solid fa-2"></i> ุณุฌู ุงููุงูููุฉ: <span id="selected-asset-name" style="text-decoration:underline;"></span>
                            </h3>
                        </div>
                        
                        <div style="display:grid; grid-template-columns: 1fr 2fr; gap:25px;">
                            <div class="card-container card-padding" style="height:fit-content; border-top: 4px solid var(--primary);">
                                <h3 style="margin:0 0 20px 0; font-size:1rem;">ุชุณุฌูู ุฒูุงุฑุฉ / ุตูุงูุฉ ุฌุฏูุฏุฉ</h3>
                                
                                <form id="visitForm">
                                    <input type="hidden" id="reportContractId">
                                    <input type="hidden" id="reportAssetIndex">
                                    
                                    <div class="form-group">
                                        <label class="form-label">ุชุงุฑูุฎ ุงูุฒูุงุฑุฉ</label>
                                        <input type="date" class="form-control" id="visitDate" required>
                                    </div>

                                    <div id="compressor-maint-options" class="hidden" style="margin-bottom:15px; background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0;">
                                        <label class="form-label" style="color:var(--primary); font-weight:bold;">1. ุงุฎุชุฑ ููุน ุงูุตูุงูุฉ (ุชุนุจุฆุฉ ุชููุงุฆูุฉ):</label>
                                        
                                        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:15px;">
                                            <button type="button" class="btn maint-select-btn" data-color="#10b981" onclick="fillMaintDetails('2000', this)" style="background:white; border:1px solid #10b981; color:#10b981; font-size:0.85rem; transition: all 0.2s ease;">
                                                <i class="fa-solid fa-check"></i> 2000 ุณุงุนุฉ
                                            </button>
                                            <button type="button" class="btn maint-select-btn" data-color="#f59e0b" onclick="fillMaintDetails('4000', this)" style="background:white; border:1px solid #f59e0b; color:#f59e0b; font-size:0.85rem; transition: all 0.2s ease;">
                                                <i class="fa-solid fa-check-double"></i> 4000 ุณุงุนุฉ
                                            </button>
                                            <button type="button" class="btn maint-select-btn" id="btn-8000-main" data-color="#ef4444" onclick="toggle8000Options(this)" style="background:white; border:1px solid #ef4444; color:#ef4444; font-size:0.85rem; transition: all 0.2s ease;">
                                                <i class="fa-solid fa-triangle-exclamation"></i> 8000 ุณุงุนุฉ
                                            </button>
                                        </div>

                                        <div id="maint-8000-sub-options" class="hidden" style="margin-bottom:15px; padding:10px; background:#fff; border:1px dashed #ef4444; border-radius:6px;">
                                            <p style="margin:0 0 8px 0; font-size:0.8rem; font-weight:bold;">ุงุฎุชุฑ ููุน ุงูุถุงุบุท ูุนูููุฉ 8000 ุณุงุนุฉ:</p>
                                            <div style="display:flex; gap:10px;">
                                                <button type="button" class="btn maint-select-btn" data-color="#ef4444" onclick="fillMaintDetails('8000-GA', this)" style="background:white; border:1px solid #ef4444; color:#ef4444; font-size:0.8rem; transition: all 0.2s ease;">
                                                    GA Compressor
                                                </button>
                                                <button type="button" class="btn maint-select-btn" data-color="#be123c" onclick="fillMaintDetails('8000-VSD', this)" style="background:white; border:1px solid #be123c; color:#be123c; font-size:0.8rem; transition: all 0.2s ease;">
                                                    GA VSD Compressor
                                                </button>
                                            </div>
                                        </div>

                                        <div style="padding-top:15px; border-top:1px dashed #cbd5e1; margin-top:10px;">
                                            <label class="form-label" style="color:var(--primary-dark); font-size:0.95rem; font-weight:800; margin-bottom:12px;"><i class="fa-solid fa-droplet" style="color:#f59e0b; margin-left:5px;"></i> 2. ุญุงูุฉ ููุชุฑ ุงูุฒูุช (ุงุฎุชุฑ ูุงุญุฏุฉ):</label>
                                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
                                                <label class="custom-maint-card">
                                                    <input type="radio" name="oilFilterOption" value="1"> 
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">ุชุบููุฑ ููุชุฑ ุฒูุช (1)</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="radio" name="oilFilterOption" value="2"> 
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check-double"></i></div>
                                                    <span class="cmc-text">ุชุบููุฑ ููุชุฑูู ุฒูุช (2)</span>
                                                </label>
                                            </div>
                                        </div>

                                        <div style="padding-top:20px; border-top:1px dashed #cbd5e1; margin-top:20px;">
                                            <label class="form-label" style="color:var(--primary-dark); font-size:0.95rem; font-weight:800; margin-bottom:12px;"><i class="fa-solid fa-gears" style="color:#64748b; margin-left:5px;"></i> 3. ูุทุน ุบูุงุฑ ุฅุถุงููุฉ ุชู ุชุบููุฑูุง (ุฎุงุฑุฌ ุงููุฎุฒู):</label>
                                            <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:12px;">
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (throttle valve kit)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Throttle valve kit</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (Coupling element)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Coupling element</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (Inlet valve kit)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Inlet valve kit</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (Silencer)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Silencer</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (non return valve)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Non return valve</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (Dust filter)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Dust filter</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (gas blast filter)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Gas blast filter</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุบููุฑ (Blow Off Valve)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Blow Off Valve</span>
                                                </label>
                                                <label class="custom-maint-card">
                                                    <input type="checkbox" name="extraParts" value="ุชู ุชุนููุฑ (Brether valve kit)">
                                                    <div class="cmc-indicator"><i class="fa-solid fa-check"></i></div>
                                                    <span class="cmc-text">Brether valve kit</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="dryer-maint-options" class="hidden" style="margin-bottom:15px; background:#fff7ed; padding:15px; border-radius:8px; border:1px solid #ffedd5;">
                                        <label class="form-label" style="color:var(--warning); font-weight:bold; color:#c2410c;">ุฎูุงุฑุงุช ุตูุงูุฉ ุงููุฌูู (Dryer):</label>
                                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                            <button type="button" class="btn maint-select-btn" data-color="#f97316" onclick="fillMaintDetails('DRYER-DRAIN', this)" style="background:white; border:1px solid #f97316; color:#f97316; font-size:0.9rem; transition: all 0.2s ease;">
                                                <i class="fa-solid fa-wrench"></i> ุชุบููุฑ ุทูู ุชุตุฑูู (Auto Drain Kit)
                                            </button>
                                        </div>
                                    </div>

                                    <div id="visit-inventory-deduction" class="hidden" style="margin-bottom:20px; background:#f0f9ff; padding:15px; border-radius:12px; border:1px solid #bae6fd;">
                                        <label class="form-label" style="color:var(--primary); font-size:0.95rem; font-weight:800; margin-bottom:12px;">
                                            <i class="fa-solid fa-boxes-stacked" style="color:#0ea5e9; margin-left:5px;"></i> ุณุญุจ ูุทุน ุบูุงุฑ ูู ุฌุฑุฏ ุงูุนููู <span id="inv-machine-name" style="color:#ef4444;"></span>:
                                        </label>
                                        <div id="visit-inventory-list">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">ุชูุงุตูู ุงูุฒูุงุฑุฉ</label>
                                        <textarea class="form-control" id="visitNotes" rows="6" placeholder="ุงูุชุจ ุงูุชูุงุตูู ูุฏููุงู ุฃู ุงุฎุชุฑ ูู ุงูุฃุฒุฑุงุฑ ุฃุนูุงู..." required></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">ูุฑููุงุช (ุชูุฑูุฑ PDF)</label>
                                        <div class="custom-upload" onclick="document.getElementById('visitFiles').click()">
                                            <i class="fa-solid fa-file-pdf" style="font-size:1.5rem; margin-bottom:10px; color:#ef4444;"></i>
                                            <p style="margin:0; font-size:0.85rem;">ุงุถุบุท ูุฑูุน ููู ุงูุชูุฑูุฑ (PDF)</p>
                                            <input type="file" id="visitFiles" hidden accept=".pdf" onchange="showFilePreview(this)">
                                        </div>
                                        <div id="files-preview" class="file-list-preview" style="margin-top:5px;"></div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="width:100%"><i class="fa-solid fa-check"></i> ุญูุธ ูู ุณุฌู ุงููุงูููุฉ</button>
                                </form>
                            </div>

                            <div>
                                <div id="history-timeline" class="timeline-container">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast-container"></div>

    <div id="lightbox">
        <div class="lb-header"><span class="lb-close" onclick="closeLightbox()">&times;</span></div>
        <div class="lb-controls">
            <button class="lb-btn" onclick="prevLBImage()"><i class="fa-solid fa-chevron-right"></i></button>
            <button class="lb-btn" onclick="nextLBImage()"><i class="fa-solid fa-chevron-left"></i></button>
        </div>
        <img id="lightbox-img" src="">
        <div class="lb-counter" id="lightbox-counter">1 / 1</div>
    </div>

    <div id="inventoryModal" class="modal">
        <div class="modal-content" style="width: 950px; max-width: 95%; background: #f1f5f9; padding:0; overflow:hidden;">
            <div style="display:flex; justify-content:space-between; align-items:center; padding:20px 25px; background:white; border-bottom:1px solid var(--border-color);">
                <h3 style="margin:0; color:var(--primary); font-size: 1.5rem;"><i class="fa-solid fa-boxes-stacked"></i> ุฌุฑุฏ ูุทุน ุบูุงุฑ ุงููุงูููุงุช</h3>
                <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:1.5rem; color:var(--text-light);" onclick="closeInventoryModal()"></i>
            </div>
            
            <div id="inventory-container" class="inv-container" style="padding: 25px; max-height: 75vh; overflow-y: auto;">
            </div>
        </div>
    </div>

    <div id="waModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fa-brands fa-whatsapp" style="color:#25D366;"></i> ุฅุฑุณุงู ุนุจุฑ ูุงุชุณุงุจ</h3>
                <span class="close" onclick="closeWAModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:15px; color:#64748b; font-size:0.9rem;">ุงุฎุชุฑ ููุน ุงูุฑุณุงูุฉ ุงููุฑุงุฏ ุฅุฑุณุงููุง ููุนููู:</p>
                <div class="wa-grid-container">
                    <button class="wa-btn full-width" onclick="sendWAMessage('schedule')">
                        <i class="fa-solid fa-calendar-days"></i><span>ุฌุฏูู ุงูุตูุงูุฉ ุงููุชููุน</span>
                    </button>
                    <button class="wa-btn" onclick="sendWAMessage('2000')"><i class="fa-solid fa-clock"></i><span>ุชุฐููุฑ 2000 ุณุงุนุฉ</span></button>
                    <button class="wa-btn" onclick="sendWAMessage('4000')"><i class="fa-solid fa-filter"></i><span>ุชุฐููุฑ 4000 ุณุงุนุฉ</span></button>
                    <button class="wa-btn" onclick="sendWAMessage('8000')"><i class="fa-solid fa-screwdriver-wrench"></i><span>ุชุฐููุฑ 8000 ุณุงุนุฉ</span></button>
                    <button class="wa-btn" onclick="sendWAMessage('16000')"><i class="fa-solid fa-gears"></i><span>ุชุฐููุฑ 16000 ุณุงุนุฉ</span></button>
                    <button class="wa-btn alert-btn" onclick="sendWAMessage('24000')"><i class="fa-solid fa-rotate"></i><span>ุชุฐููุฑ ุนูุฑุฉ 24000</span></button>
                </div>
            </div>
        </div>
    </div>

    <div id="contractModal" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 style="margin:0; color:var(--primary);">ุนูุฏ ุฌุฏูุฏ / ุชุนุฏูู ุจูุงูุงุช</h3>
                <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:1.2rem; color:var(--text-light);" onclick="closeModal()"></i>
            </div>
            <form id="contractForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label class="form-label">ุงุณู ุงูุดุฑูุฉ</label>
                    <input type="text" class="form-control" id="company" placeholder="ูุซุงู: ุดุฑูุฉ ุงูุนุฒ ููุญุฏูุฏ" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ุงุณู ุงูุนููู ุงููุณุคูู</label>
                        <input type="text" class="form-control" id="client" placeholder="ูุซุงู: ู. ุฃุญูุฏ ูุญูุฏ" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ุฑูู ูุงุชุณุงุจ</label>
                        <input type="text" class="form-control" id="phone" placeholder="010xxxxxxxxx" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุนูุฏ</label>
                        <input type="date" class="form-control" id="startDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ุชุงุฑูุฎ ููุงูุฉ ุงูุนูุฏ</label>
                        <input type="date" class="form-control" id="endDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ุนุฏุฏ ุงูุฒูุงุฑุงุช ุงูููู</label>
                    <input type="number" class="form-control" id="totalVisits" placeholder="ูุซุงู: 12" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ูุณุฎุฉ ูู ุงูุนูุฏ (PDF ูุทููุจ)</label>
                    <div class="custom-upload" onclick="document.getElementById('contractFile').click()">
                        <i class="fa-solid fa-file-pdf" style="font-size:2rem; margin-bottom:10px; color:#ef4444;"></i>
                        <p style="margin:0;">ุงุถุบุท ูุฑูุน ููู ุงูุนูุฏ (PDF ููุท)</p>
                        <input type="file" id="contractFile" hidden accept=".pdf" onchange="showContractFilePreview(this)">
                    </div>
                    <div id="contract-file-preview" class="file-list-preview" style="margin-top:5px; font-size:0.85rem; color:var(--text-light);"></div>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%; margin-top:10px;">ุญูุธ ุงูุจูุงูุงุช</button>
            </form>
        </div>
    </div>

    <div id="unholdModal" class="modal">
        <div class="modal-content" style="width: 400px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 style="margin:0; color:var(--success);"><i class="fa-solid fa-play"></i> ุฅุนุงุฏุฉ ุชูุนูู ุงูุนูุฏ</h3>
                <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:1.2rem; color:var(--text-light);" onclick="closeUnholdModal()"></i>
            </div>
            <form id="unholdForm">
                <input type="hidden" id="unholdContractId">
                <div style="background:#f0fdf4; padding:15px; border-radius:8px; margin-bottom:15px; border:1px solid #bbf7d0;">
                    <p style="margin:0; font-size:0.9rem; color:#166534;">ุณูุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุนูุฏ. ูุฑุฌู ุฅุฏุฎุงู ุงูุชูุงุฑูุฎ ุงูุฌุฏูุฏุฉ ูุงุณุชููุงู ุงูุฏูุฑุฉ.</p>
                </div>
                <div class="form-group">
                    <label class="form-label">ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ุงูุฌุฏูุฏ</label>
                    <input type="date" class="form-control" id="unholdStartDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ุชุงุฑูุฎ ุงูููุงูุฉ ุงูุฌุฏูุฏ</label>
                    <input type="date" class="form-control" id="unholdEndDate" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%; background:var(--success); border-color:var(--success);">ุชุฃููุฏ ูุชุดุบูู</button>
            </form>
        </div>
    </div>

    <div id="addMachineModal" class="modal">
        <div class="modal-content" style="width: 650px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 style="margin:0; color:var(--primary);">ุฅุถุงูุฉ ูุงูููุฉ ุฌุฏูุฏุฉ</h3>
                <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:1.2rem; color:var(--text-light);" onclick="closeAddMachineModal()"></i>
            </div>
            
            <div id="machine-type-selection">
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px; margin-bottom:20px;">
                    <div class="type-card" onclick="selectMachineType('compressor')"><i class="fa-solid fa-wind"></i><h4>Compressor</h4></div>
                    <div class="type-card" onclick="selectMachineType('dryer')"><i class="fa-solid fa-temperature-arrow-down"></i><h4>Dryer</h4></div>
                    <div class="type-card" onclick="selectMachineType('vacuum')"><i class="fa-solid fa-fan"></i><h4>Vacuum Pump</h4></div>
                </div>
            </div>

            <div id="dryer-form-section" class="hidden">
                <button class="btn" onclick="resetMachineModal()" style="padding:5px 10px; font-size:0.8rem; margin-bottom:15px; background:#f1f5f9;"><i class="fa-solid fa-arrow-right"></i> ุฑุฌูุน</button>
                <form id="dryerForm">
                    <div class="form-group">
                        <label class="form-label">ุงุณู ุงููุฌูู (Dryer Name)</label>
                        <div style="display: flex; gap: 20px; background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; align-items: center;">
                            <label style="cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:bold; margin:0;"><input type="radio" name="dryerName" value="FD dryer" checked> FD dryer</label>
                            <label style="cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:bold; margin:0;"><input type="radio" name="dryerName" value="FX dryer"> FX dryer</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ูุฏุฑุฉ ุงููุฌูู (Capacity)</label>
                        <div style="display: flex; gap: 20px; background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; align-items: center;">
                            <label style="cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:bold; margin:0;"><input type="radio" name="dryerCapacity" value="FX350" checked> FX350</label>
                            <label style="cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:bold; margin:0;"><input type="radio" name="dryerCapacity" value="FD100"> FD100</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ุงูุฑูู ุงูุชุณูุณูู (Serial Number)</label>
                        <input type="text" class="form-control" id="dryerSerial" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ุณูุฉ ุงูุชุตููุน</label>
                            <input type="number" class="form-control" id="dryerYear" placeholder="2024" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ููุน ุงููุฑููู</label>
                            <div style="display: flex; gap: 20px; background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; align-items: center;">
                                <label style="cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:bold; margin:0;"><input type="radio" name="dryerFreon" value="R410" checked> R410</label>
                                <label style="cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:bold; margin:0;"><input type="radio" name="dryerFreon" value="R404"> R404</label>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%; margin-top:10px;">ุญูุธ ุงููุฌูู</button>
                </form>
            </div>

            <div id="vacuum-form-section" class="hidden">
                <button class="btn" onclick="resetMachineModal()" style="padding:5px 10px; font-size:0.8rem; margin-bottom:15px; background:#f1f5f9;"><i class="fa-solid fa-arrow-right"></i> ุฑุฌูุน</button>
                <form id="vacuumForm">
                    <div class="form-group"><label class="form-label">ุงุณู ุงูู Vacuum pump</label><input type="text" class="form-control" id="vacuumName" required></div>
                    <div class="form-group"><label class="form-label">ุงูุฑูู ุงูุชุณูุณูู (Serial Number)</label><input type="text" class="form-control" id="vacuumSerial" required></div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">ุณูุฉ ุงูุชุตููุน</label><input type="number" class="form-control" id="vacuumYear" placeholder="2024" required></div>
                        <div class="form-group"><label class="form-label">ุงูู Bar</label><input type="number" step="any" class="form-control" id="vacuumBar" placeholder="ูุซุงู: 8" required></div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%; margin-top:10px;">ุญูุธ Vacuum pump</button>
                </form>
            </div>

            <div id="compressor-choice-section" class="hidden">
                 <button class="btn" onclick="resetMachineModal()" style="padding:5px 10px; font-size:0.8rem; margin-bottom:15px; background:#f1f5f9;"><i class="fa-solid fa-arrow-right"></i> ุฑุฌูุน</button>
                 <div style="display:flex; flex-direction:column; gap:15px;">
                     <button class="btn btn-primary" onclick="showCompressorForm('new')" style="justify-content:center; padding:15px;">New Compressor (Zero)</button>
                     <button class="btn" onclick="showCompressorForm('used')" style="justify-content:center; padding:15px; background:var(--secondary); color:white;">Used / Existing Compressor</button>
                 </div>
            </div>

            <div id="used-compressor-form-section" class="hidden">
                <button class="btn" onclick="backToCompChoice()" style="padding:5px 10px; font-size:0.8rem; margin-bottom:15px; background:#f1f5f9;"><i class="fa-solid fa-arrow-right"></i> ุฑุฌูุน</button>
                <form id="usedCompressorForm">
                    <div style="background:#f8fafc; padding:15px; border-radius:8px; margin-bottom:15px;">
                        <h4 style="margin:0 0 10px 0; font-size:0.9rem; color:var(--primary);">ุจูุงูุงุช ุงููุงูููุฉ</h4>
                        <div class="form-row">
                            <div class="form-group" style="margin-bottom:10px;"><label class="form-label">ุงุณู ุงูู Compressor</label><input type="text" class="form-control" id="compName" required></div>
                            <div class="form-group" style="margin-bottom:10px;"><label class="form-label">Serial Number</label><input type="text" class="form-control" id="compSerial" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="margin:0;"><label class="form-label">ุณูุฉ ุงูุชุตููุน</label><input type="number" class="form-control" id="compYear" placeholder="2020" required></div>
                            <div class="form-group" style="margin:0;"><label class="form-label">ุชุงุฑูุฎ ุจุฏุก ุงูุชุดุบูู</label><input type="date" class="form-control" id="compStartDate" required></div>
                        </div>
                        
                        <div class="form-row" id="hoursDataContainer" style="margin-top:15px; display:none;">
                            <div class="form-group" style="margin:0;"><label class="form-label" style="color:var(--primary);">ุณุงุนุงุช ุขุฎุฑ ุตูุงูุฉ ุชูุช</label><input type="number" class="form-control" id="compLastMaintHours" placeholder="ูุซุงู: 2000" onkeyup="updatePlanPreview()"></div>
                            <div class="form-group" style="margin:0;"><label class="form-label" style="color:var(--warning);">ุณุงุนุงุช ุงูุชุดุบูู ุงูุญุงููุฉ</label><input type="number" class="form-control" id="compCurrentHours" placeholder="ูุซุงู: 2500" onkeyup="updatePlanPreview()"></div>
                        </div>
                    </div>

                    <div style="background:#f0f9ff; padding:15px; border-radius:8px; margin-bottom:15px; border:1px solid #bae6fd;">
                        <h4 style="margin:0 0 10px 0; font-size:0.9rem; color:#0369a1;">ุจูุงูุงุช ุงูุชุดุบูู (ูุญุณุงุจ ุงูููุงุนูุฏ)</h4>
                        <div class="form-row">
                            <div class="form-group" style="margin:0;"><label class="form-label">ุณุงุนุงุช ุชุดุบูู / ููู</label><input type="number" class="form-control" id="compDailyHours" placeholder="8" onkeyup="updatePlanPreview()" required></div>
                            <div class="form-group" style="margin:0;"><label class="form-label">ุฃูุงู ุฅุฌุงุฒุฉ / ุดูุฑ</label><input type="number" class="form-control" id="compDaysOff" placeholder="4" onkeyup="updatePlanPreview()" required></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" style="display:flex; justify-content:space-between;">
                            <span>ุฎุทุฉ ุงูุตูุงูุงุช ุงููุงุฏูุฉ (Maintenance Plan)</span>
                            <span style="font-size:0.75rem; color:var(--primary); cursor:pointer;" onclick="setDefaultPlan()">ุงุณุชุฎุฏุงู ุงูู Default (A B A C)</span>
                        </label>
                        <div class="plan-builder-btns">
                            <div class="plan-btn plan-btn-A" onclick="addPlanStep('A')">A<span>2000</span></div>
                            <div class="plan-btn plan-btn-B" onclick="addPlanStep('B')">B<span>4000</span></div>
                            <div class="plan-btn plan-btn-C" onclick="addPlanStep('C')">C<span>8000</span></div>
                            <div class="plan-btn plan-btn-D" onclick="addPlanStep('D')">D<span>16000</span></div>
                            <div class="plan-btn plan-btn-E" onclick="addPlanStep('E')">E<span>24000</span></div>
                        </div>
                        <div class="plan-timeline" id="planTimelineContainer"><div style="text-align:center; color:#aaa; font-size:0.85rem; padding-top:20px;">ุงุถุบุท ุนูู ุงูุฃุฒุฑุงุฑ ูุชุฑุชูุจ ุงูุตูุงูุงุช ุงููุงุฏูุฉ</div></div>
                        <div style="text-align:left; margin-top:5px;"><button type="button" class="btn" style="color:var(--danger); font-size:0.8rem; padding:0;" onclick="clearPlan()">ูุณุญ ุงูุฎุทุฉ</button></div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%;">ุญูุธ ุงูู Compressor</button>
                </form>
            </div>
        </div>
    </div>

    <div id="editVisitModal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 style="margin:0; color:var(--primary);">ุชุนุฏูู ุชูุงุตูู ุงูุฒูุงุฑุฉ</h3>
                <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:1.2rem; color:var(--text-light);" onclick="closeEditModal()"></i>
            </div>
            <form id="editVisitForm">
                <input type="hidden" id="editVisitContractId"><input type="hidden" id="editVisitIndex">
                <div class="form-group"><label class="form-label">ุชุงุฑูุฎ ุงูุฒูุงุฑุฉ</label><input type="date" class="form-control" id="editVisitDate" required></div>
                <div class="form-group"><label class="form-label">ุชูุงุตูู ุงูุฒูุงุฑุฉ</label><textarea class="form-control" id="editVisitNotes" rows="4" required></textarea></div>
                <div class="form-group"><label class="form-label">ุงููุฑููุงุช ุงูุญุงููุฉ</label><div id="edit-img-container" class="edit-img-grid"></div></div>
                <div class="form-group"><label class="form-label">ุฅุถุงูุฉ ูุฑูู ุฌุฏูุฏ (PDF)</label><input type="file" id="editVisitNewFiles" class="form-control" accept=".pdf"></div>
                <button type="submit" class="btn btn-primary" style="width:100%">ุญูุธ ุงูุชุนุฏููุงุช</button>
            </form>
        </div>
    </div>

    <div id="machineDetailsModal" class="modal">
        <div class="modal-content" style="width: 700px; background: #f8fafc;">
            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:20px;">
                <div>
                    <h2 style="margin:0; color:var(--primary);" id="detail-machine-name">ุงุณู ุงููุงูููุฉ</h2>
                    <p style="margin:5px 0 0; color:var(--text-light); font-size:0.9rem;" id="detail-machine-serial"></p>
                    <p style="margin:5px 0 0; color:var(--info); font-size:0.85rem; font-weight:bold;" id="detail-machine-startdate"></p>
                </div>
                <div class="icon-btn" onclick="closeMachineDetailsModal()" style="background:white;"><i class="fa-solid fa-xmark"></i></div>
            </div>
            <div class="machine-stats-row">
                <div class="m-stat-card"><div class="icon-box blue"><i class="fa-solid fa-clock"></i></div><div><span class="label">ุณุงุนุงุช ุงูุนูู (Total)</span><h3 id="detail-current-hours">0</h3></div></div>
                <div class="m-stat-card"><div class="icon-box green"><i class="fa-solid fa-gauge-high"></i></div><div><span class="label">ูุนุฏู ุงูุชุดุบูู</span><h3 id="detail-daily-hours">0 <small>ุณุงุนุฉ/ููู</small></h3></div></div>
                <div class="m-stat-card"><div class="icon-box orange"><i class="fa-solid fa-calendar-xmark"></i></div><div><span class="label">ุฃูุงู ุงูุฑุงุญุฉ</span><h3 id="detail-days-off">0 <small>ููู/ุดูุฑ</small></h3></div></div>
            </div>
            <div style="background:white; border-radius:12px; padding:20px; border:1px solid var(--border-color); margin-top:20px;">
                <h4 style="margin:0 0 20px 0; color:var(--primary); display:flex; align-items:center; gap:10px;"><i class="fa-solid fa-list-check"></i> ุฌุฏูู ุฎุทุฉ ุงูุตูุงูุฉ ูุชููุนุงุชูุง</h4>
                <div class="timeline-wrapper" id="machine-plan-timeline"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
